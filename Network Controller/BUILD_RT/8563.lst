C51 COMPILER V9.06   8563                                                                  05/28/2013 10:15:30 PAGE 1   


C51 COMPILER V9.06, COMPILATION OF MODULE 8563
OBJECT MODULE PLACED IN .\8563.obj
COMPILER INVOKED BY: E:\Keil_4_9.06\C51\BIN\C51.EXE ..\src\i2c\8563.c LARGE OMF2 ROM(D16M) BROWSE INTVECTOR(0X6020) INCD
                    -IR(..\SRC\cpu\;..\SRC\ethernet\;..\SRC\swdma\;..\SRC\mstimer\;..\SRC\uart\;..\SRC\main\;..\SRC\tcpip\;..\SRC\hsur\;..\SR
                    -C\debug\;..\SRC\dhcp\;..\SRC\dns\;..\SRC\adapter\;..\SRC\pppoe\;..\SRC\management;..\SRC\i2c\;..\SRC\flash\;..\SRC\buffe
                    -r\;..\SRC\onewire\;..\SRC\http\;..\SRC\web\;..\SRC\AX110xx_SNTP_v100;..\Src\FreeRTOSSource\portable\Keil\AX11000\;..\Src
                    -\FreeRTOSSource\include\;..\Src\schedule\;..\src\bacnet;..\src\include;..\src\LCD;..\src\version;..\src\modbusTCP;..\src
                    -\gs2e;..\src\adpter1;..\src\scan;..\src\gsm;..\src\dyndns) DEFINE(KEIL_AX11000) VARBANKING DEBUG PRINT(.\8563.lst) OBJEC
                    -T(.\8563.obj)

line level    source

   1          #include        <stdio.h>
   2          #include        "reg80390.h"
   3          #include        "types.h"
   4          #include        "buffer.h"
   5          #include        "i2c.h"
   6          #include        "i2capi.h"
   7          #include    "8563.h"
   8          
   9          STR_CLK Time;
  10          extern U8_T  far Para[400]; 
  11          
  12          
  13          U8_T BcdToHex(U8_T byte)  
  14          {
  15   1              U8_T i,j;                 
  16   1          i = byte >> 4;
  17   1              j = byte & 0x0f;     
  18   1              return i*10+j;
  19   1      }
  20          
  21          
  22          U8_T HexToBcd(U8_T byte)
  23          {
  24   1              U8_T i,j;
  25   1              i = byte / 10;
  26   1              j = byte % 10;
  27   1              return  (i << 4) + j ;
  28   1      }
  29          
  30          
  31          U8_T Set_Clock(U8_T addr,U8_T dat)
  32          {
  33   1              U8_T  result;
  34   1              U16_T  i;
  35   1              result = I2C_ByteWrite(0x51, addr, HexToBcd(dat), I2C_STOP_COND);
  36   1              for(i = 0; i < 2500; i++)       ;
  37   1              return result;
  38   1      }
  39          
  40          
  41          
  42          
  43          void Initial_Clock(void)
  44          {
  45   1              //U16_T i;
  46   1      
  47   1              Set_Clock(0,0);
  48   1              //for(i=0;i<500;i++);
  49   1              Set_Clock(1,0);
C51 COMPILER V9.06   8563                                                                  05/28/2013 10:15:30 PAGE 2   

  50   1              //for(i=0;i<500;i++);
  51   1              Set_Clock(2,Time.UN.Setime[7]); //sec
  52   1              //for(i=0;i<500;i++);
  53   1              Set_Clock(3,Time.UN.Setime[6]);//min
  54   1              //for(i=0;i<500;i++);
  55   1              Set_Clock(4,Time.UN.Setime[5]);//hour
  56   1              //for(i=0;i<300;i++);
  57   1              Set_Clock(5,Time.UN.Setime[4]);//day
  58   1              //for(i=0;i<300;i++);
  59   1              Set_Clock(6,Time.UN.Setime[3]);//which
  60   1              //for(i=0;i<300;i++);
  61   1              Set_Clock(7,Time.UN.Setime[2]);//month
  62   1              //for(i=0;i<300;i++);
  63   1              Set_Clock(8,Time.UN.Setime[1]);//year
  64   1      
  65   1      }
  66          
  67          
  68          
  69          U8_T Read_Clock(U8_T regaddr)
  70          {    U8_T i,temp[7];
  71   1           I2C_BUF    Read_Dat;  
  72   1              
  73   1            I2C_RdmRead(0x51, regaddr, &Read_Dat, 7, I2C_STOP_COND);
  74   1                   
  75   1               for(i = 0; i < 7; i++)
  76   1                   temp[i] = Read_Dat.I2cData[i];
  77   1      
  78   1                      if(temp[5] & 0x80)
  79   1                              Time.UN.Current.centary = 19;
  80   1                      else
  81   1                              Time.UN.Current.centary = 20;
  82   1                 
  83   1              temp[0] = temp[0] & 0x7f;//sec
  84   1              temp[1] = temp[1] & 0x7f;//min
  85   1              temp[2] = temp[2] & 0x3f;//hour
  86   1              temp[3] = temp[3] & 0x3f;//day
  87   1              temp[4] = temp[4] & 0x07;//day of week
  88   1                  temp[5] = temp[5] & 0x1f; //month
  89   1              temp[6] = temp[6] & 0xff; //month
  90   1      
  91   1              Time.UN.Current.sec       =  BcdToHex(temp[0]);//  Para[407]= 
  92   1              Time.UN.Current.min       =  BcdToHex(temp[1]);// Para[406]= 
  93   1              Time.UN.Current.hour      =  BcdToHex(temp[2]);// Para[405]= 
  94   1              Time.UN.Current.day       =  BcdToHex(temp[3]);// Para[404]= 
  95   1                  Time.UN.Current.dayofweek =  BcdToHex(temp[4]);// Para[403]= 
  96   1              Time.UN.Current.month     =  BcdToHex(temp[5]);// Para[402]= 
  97   1                  Time.UN.Current.year      =  BcdToHex(temp[6]);// Para[401]= 
  98   1      //        Time.UN.Current.centary   = 20;                // Para[400]= 
  99   1          
 100   1              return 1;
 101   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    416    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      8      77
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V9.06   8563                                                                  05/28/2013 10:15:30 PAGE 3   

   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
