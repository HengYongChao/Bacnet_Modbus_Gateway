C51 COMPILER V9.06   LCD                                                                   05/24/2013 13:18:44 PAGE 1   


C51 COMPILER V9.06, COMPILATION OF MODULE LCD
OBJECT MODULE PLACED IN .\LCD.obj
COMPILER INVOKED BY: E:\Keil_4_9.06\C51\BIN\C51.EXE ..\src\LCD\LCD.c LARGE OMF2 ROM(D16M) BROWSE INTVECTOR(0X6020) INCDI
                    -R(..\SRC\cpu\;..\SRC\ethernet\;..\SRC\swdma\;..\SRC\mstimer\;..\SRC\uart\;..\SRC\main\;..\SRC\tcpip\;..\SRC\hsur\;..\SRC
                    -\debug\;..\SRC\dhcp\;..\SRC\dns\;..\SRC\adapter\;..\SRC\pppoe\;..\SRC\management;..\SRC\i2c\;..\SRC\flash\;..\SRC\buffer
                    -\;..\SRC\onewire\;..\SRC\http\;..\SRC\web\;..\SRC\AX110xx_SNTP_v100;..\Src\FreeRTOSSource\portable\Keil\AX11000\;..\Src\
                    -FreeRTOSSource\include\;..\Src\schedule\;..\src\bacnet;..\src\include;..\src\LCD;..\src\version;..\src\modbusTCP;..\src\
                    -gs2e;..\src\adpter1;..\src\scan;..\src\gsm) DEFINE(KEIL_AX11000) VARBANKING DEBUG PRINT(.\LCD.lst) OBJECT(.\LCD.obj)

line level    source

   1          #include "reg80390.h"
   2          #include "../LCD/lcd.h"
   3          #include  <intrins.h> 
   4          #include "system.h"
   5          #include <string.h>
   6          #include <ctype.h>  
   7          
   8          
   9          unsigned char const code aby_Char_Table[10] = {'0','1','2','3','4','5','6','7','8','9'};
  10          
  11          /*(0) !(1) "(2) #(3) $(4) %(5) &(6) '(7) ((8) )(9) *(10) +(11) ,(12) -(13) .(14) /(15)
  12           0(16) 1(17) 2(18) 3(19) 4(20) 5(21) 6(22) 7(23) 8(24) 9(25) :(26) ;(27) <(28) =(29) >(30) ?(31)
  13           @(32) A(33) B(34) C(35) D(36) E(37) F(38) G(39) H(40) I(41) J(42) K(43) L(44) M(45) N(46) O(47)
  14           P(48) Q(49) R(50) S(51) T(52) U(53) V(54) W(55) X(56) Y(57) Z(58) [(59) \(60) ](61) ^(62) _(63)
  15           `(64) a(65) b(66) c(67) d(68) e(69) f(70) g(71) h(72) i(73) j(74) k(75) l(76) m(77) n(78) o(79)
  16           p(80) q(81) r(82) s(83) t(84) u(85) v(86) w(87) x(88) y(89) z(90) {(91) |(92) }(93) ~(94) |(95)*/
  17          
  18          
  19          
  20          
  21          
  22          
  23          
  24          unsigned char const code nAsciiDot[96][2][6] =  {
  25          
  26          {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*" ",0*/
  27          
  28          {0x00,0x00,0xF8,0x00,0x00,0x00,0x00,0x00,0x33,0x00,0x00,0x00},/*"!",1*/
  29          
  30          {0x00,0x08,0x06,0x08,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*""",2*/
  31          
  32          {0x40,0x40,0xF8,0x40,0xF8,0x40,0x04,0x3F,0x05,0x3F,0x05,0x04},/*"#",3*/
  33          
  34          {0x70,0x88,0xFC,0x08,0x30,0x00,0x18,0x20,0xFF,0x21,0x1E,0x00},/*"$",4*/
  35          
  36          {0xF0,0x98,0x60,0xE0,0x38,0x00,0x00,0x31,0x0E,0x1F,0x33,0x0C},/*"%",5*/
  37          
  38          {0x00,0xF0,0x88,0x70,0x00,0x00,0x1E,0x21,0x26,0x19,0x27,0x20},/*"&",6*/
  39          
  40          {0x10,0x0E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*"'",7*/
  41          
  42          {0x00,0x00,0x00,0xF0,0x0C,0x02,0x00,0x00,0x00,0x0F,0x30,0x40},/*"(",8*/
  43          
  44          {0x00,0x06,0x18,0xE0,0x00,0x00,0x00,0x60,0x18,0x07,0x00,0x00},/*")",9*/
  45          
  46          {0x40,0x80,0xF0,0x80,0x40,0x00,0x02,0x01,0x0F,0x01,0x02,0x00},/*"*",10*/
  47          
  48          {0x00,0x00,0xF0,0x00,0x00,0x00,0x01,0x01,0x1F,0x01,0x01,0x00},/*"+",11*/
  49          
  50          {0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x70,0x00,0x00,0x00,0x00},/*",",12*/
C51 COMPILER V9.06   LCD                                                                   05/24/2013 13:18:44 PAGE 2   

  51          
  52          {0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x01,0x01,0x00},/*"-",13*/
  53          
  54          {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x00,0x00,0x00,0x00},/*".",14*/
  55          
  56          {0x00,0x00,0x80,0x70,0x0C,0x00,0x60,0x1C,0x03,0x00,0x00,0x00},/*"/",15*/
  57          
  58          {0xF0,0x08,0x08,0x18,0xE0,0x00,0x1F,0x20,0x20,0x30,0x0F,0x00},/*"0",16*/
  59          
  60          {0x00,0x10,0xF8,0x00,0x00,0x00,0x00,0x20,0x3F,0x20,0x00,0x00},/*"1",17*/
  61          
  62          {0x70,0x08,0x08,0x08,0xF0,0x00,0x30,0x2C,0x22,0x21,0x30,0x00},/*"2",18*/
  63          
  64          {0x30,0x08,0x88,0x88,0x70,0x00,0x18,0x20,0x20,0x31,0x1E,0x00},/*"3",19*/
  65          
  66          {0x00,0x80,0x60,0xF0,0x00,0x00,0x06,0x05,0x24,0x3F,0x24,0x04},/*"4",20*/
  67          
  68          {0xF8,0x08,0x88,0x88,0x08,0x00,0x19,0x21,0x20,0x31,0x1F,0x00},/*"5",21*/
  69          
  70          {0xE0,0x18,0x88,0x98,0x00,0x00,0x0F,0x31,0x20,0x20,0x1F,0x00},/*"6",22*/
  71          
  72          {0x38,0x08,0x08,0xE8,0x18,0x00,0x00,0x00,0x3F,0x00,0x00,0x00},/*"7",23*/
  73          
  74          {0x70,0x88,0x08,0x88,0x70,0x00,0x1E,0x21,0x21,0x21,0x1E,0x00},/*"8",24*/
  75          
  76          {0xF0,0x08,0x08,0x18,0xE0,0x00,0x01,0x32,0x22,0x31,0x0F,0x00},/*"9",25*/
  77          
  78          {0x00,0x00,0xC0,0x00,0x00,0x00,0x00,0x00,0x30,0x00,0x00,0x00},/*":",26*/
  79          
  80          {0x00,0x00,0x80,0x00,0x00,0x00,0x00,0x00,0xE0,0x00,0x00,0x00},/*";",27*/
  81          
  82          {0x00,0x00,0x80,0x60,0x10,0x08,0x00,0x01,0x02,0x0C,0x10,0x20},/*"<",28*/
  83          
  84          {0x40,0x40,0x40,0x40,0x40,0x00,0x04,0x04,0x04,0x04,0x04,0x00},/*"=",29*/
  85          
  86          {0x00,0x08,0x30,0x40,0x80,0x00,0x00,0x20,0x18,0x04,0x02,0x01},/*">",30*/
  87          
  88          {0x70,0x08,0x08,0x88,0x70,0x00,0x00,0x00,0x37,0x01,0x00,0x00},/*"?",31*/
  89          
  90          {0xF0,0x10,0x88,0x78,0xF0,0x00,0x1F,0x20,0x27,0x34,0x0F,0x00},/*"@",32*/
  91          
  92          {0x00,0x80,0x78,0xE0,0x00,0x00,0x20,0x3F,0x02,0x03,0x3E,0x20},/*"A",33*/
  93          
  94          {0x08,0xF8,0x88,0x88,0x70,0x00,0x20,0x3F,0x20,0x20,0x1F,0x00},/*"B",34*/
  95          
  96          {0xF0,0x10,0x08,0x08,0x18,0x00,0x1F,0x20,0x20,0x20,0x10,0x00},/*"C",35*/
  97          
  98          {0x08,0xF8,0x08,0x10,0xE0,0x00,0x20,0x3F,0x20,0x10,0x0F,0x00},/*"D",36*/
  99          
 100          {0x08,0xF8,0x88,0xE8,0x18,0x00,0x20,0x3F,0x20,0x23,0x30,0x00},/*"E",37*/
 101          
 102          {0x08,0xF8,0x88,0xE8,0x18,0x00,0x20,0x3F,0x20,0x03,0x00,0x00},/*"F",38*/
 103          
 104          {0xE0,0x10,0x08,0x08,0x18,0x00,0x0F,0x10,0x20,0x22,0x1E,0x02},/*"G",39*/
 105          
 106          {0x08,0xF8,0x00,0x00,0xF8,0x08,0x20,0x3F,0x01,0x01,0x3F,0x20},/*"H",40*/
 107          
 108          {0x08,0x08,0xF8,0x08,0x08,0x00,0x20,0x20,0x3F,0x20,0x20,0x00},/*"I",41*/
 109          
 110          {0x00,0x08,0x08,0xF8,0x08,0x08,0xC0,0x80,0x80,0x7F,0x00,0x00},/*"J",42*/
 111          
 112          {0x08,0xF8,0x88,0x60,0x18,0x08,0x20,0x3F,0x20,0x07,0x3C,0x20},/*"K",43*/
C51 COMPILER V9.06   LCD                                                                   05/24/2013 13:18:44 PAGE 3   

 113          
 114          {0x08,0xF8,0x08,0x00,0x00,0x00,0x20,0x3F,0x20,0x20,0x20,0x30},/*"L",44*/
 115          
 116          {0xF8,0xF8,0x00,0xF8,0xF8,0x00,0x3F,0x00,0x3F,0x00,0x3F,0x00},/*"M",45*/
 117          
 118          {0x08,0xF8,0xE0,0x08,0xF8,0x08,0x20,0x3F,0x21,0x06,0x3F,0x00},/*"N",46*/
 119          
 120          {0xF0,0x08,0x08,0x18,0xE0,0x00,0x1F,0x20,0x20,0x30,0x0F,0x00},/*"O",47*/
 121          
 122          {0x08,0xF8,0x08,0x08,0xF0,0x00,0x20,0x3F,0x21,0x01,0x00,0x00},/*"P",48*/
 123          
 124          {0xF0,0x08,0x08,0x18,0xE0,0x00,0x0F,0x34,0x2C,0x70,0x7F,0x00},/*"Q",49*/
 125          
 126          {0x08,0xF8,0x88,0x88,0x70,0x00,0x20,0x3F,0x20,0x03,0x3C,0x20},/*"R",50*/
 127          
 128          {0x70,0x88,0x08,0x08,0x18,0x00,0x30,0x20,0x21,0x22,0x1C,0x00},/*"S",51*/
 129          
 130          {0x18,0x08,0xF8,0x08,0x18,0x00,0x00,0x20,0x3F,0x20,0x00,0x00},/*"T",52*/
 131          
 132          {0x08,0xF8,0x00,0x00,0xF8,0x08,0x00,0x1F,0x20,0x20,0x1F,0x00},/*"U",53*/
 133          
 134          {0x08,0xF8,0x00,0x80,0xF8,0x08,0x00,0x03,0x3C,0x0F,0x00,0x00},/*"V",54*/
 135          
 136          {0x78,0x84,0xF8,0xC0,0x78,0x00,0x00,0x3F,0x00,0x3F,0x00,0x00},/*"W",55*/
 137          
 138          {0x08,0x78,0x80,0x78,0x08,0x00,0x20,0x3C,0x03,0x3C,0x20,0x00},/*"X",56*/
 139          
 140          {0x08,0xF8,0x80,0x78,0x08,0x00,0x00,0x20,0x3F,0x20,0x00,0x00},/*"Y",57*/
 141          
 142          {0x18,0x08,0x88,0x78,0x08,0x00,0x20,0x3C,0x23,0x20,0x30,0x00},/*"Z",58*/
 143          
 144          {0x00,0x00,0xFE,0x02,0x02,0x00,0x00,0x00,0x7F,0x40,0x40,0x00},/*"[",59*/
 145          
 146          {0x00,0x38,0xC0,0x00,0x00,0x00,0x00,0x00,0x01,0x1E,0x60,0x00},/*"\",60*/
 147          
 148          {0x00,0x02,0x02,0xFE,0x00,0x00,0x00,0x40,0x40,0x7F,0x00,0x00},/*"]",61*/
 149          
 150          {0x00,0x04,0x02,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*"^",62*/
 151          
 152          {0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x80},/*"_",63*/
 153          
 154          {0x00,0x02,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*"`",64*/
 155          
 156          {0x00,0x00,0x80,0x80,0x80,0x00,0x00,0x3D,0x26,0x22,0x3F,0x20},/*"a",65*/
 157          
 158          {0x08,0xF8,0x00,0x80,0x00,0x00,0x00,0x1F,0x21,0x20,0x1F,0x00},/*"b",66*/
 159          
 160          {0x00,0x00,0x80,0x80,0x80,0x00,0x00,0x1F,0x21,0x20,0x21,0x00},/*"c",67*/
 161          
 162          {0x00,0x00,0x80,0x88,0xF8,0x00,0x00,0x1F,0x20,0x20,0x3F,0x20},/*"d",68*/
 163          
 164          {0x00,0x00,0x80,0x80,0x00,0x00,0x00,0x1F,0x22,0x22,0x23,0x00},/*"e",69*/
 165          
 166          {0x00,0x80,0xF0,0x88,0x88,0x18,0x00,0x20,0x3F,0x20,0x20,0x00},/*"f",70*/
 167          
 168          {0x00,0x00,0x80,0x80,0x80,0x80,0x00,0x6B,0x94,0x94,0x93,0x60},/*"g",71*/
 169          
 170          {0x08,0xF8,0x00,0x80,0x80,0x00,0x20,0x3F,0x21,0x00,0x3F,0x20},/*"h",72*/
 171          
 172          {0x00,0x80,0x98,0x00,0x00,0x00,0x00,0x20,0x3F,0x20,0x00,0x00},/*"i",73*/
 173          
 174          {0x00,0x00,0x80,0x98,0x00,0x00,0xC0,0x80,0x80,0x7F,0x00,0x00},/*"j",74*/
C51 COMPILER V9.06   LCD                                                                   05/24/2013 13:18:44 PAGE 4   

 175          
 176          {0x08,0xF8,0x00,0x80,0x80,0x80,0x20,0x3F,0x24,0x06,0x39,0x20},/*"k",75*/
 177          
 178          {0x08,0x08,0xF8,0x00,0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00},/*"l",76*/
 179          
 180          {0x80,0x80,0x80,0x80,0x00,0x00,0x3F,0x00,0x3F,0x00,0x3F,0x00},/*"m",77*/
 181          
 182          {0x80,0x80,0x00,0x80,0x80,0x00,0x20,0x3F,0x21,0x00,0x3F,0x20},/*"n",78*/
 183          
 184          {0x00,0x00,0x80,0x80,0x00,0x00,0x00,0x1F,0x20,0x20,0x1F,0x00},/*"o",79*/
 185          
 186          {0x80,0x80,0x80,0x80,0x00,0x00,0x80,0xFF,0xA0,0x20,0x1F,0x00},/*"p",80*/
 187          
 188          {0x00,0x00,0x80,0x80,0x80,0x00,0x00,0x1F,0x20,0xA0,0xFF,0x80},/*"q",81*/
 189          
 190          {0x80,0x80,0x00,0x80,0x80,0x00,0x20,0x3F,0x21,0x00,0x01,0x00},/*"r",82*/
 191          
 192          {0x00,0x00,0x80,0x80,0x80,0x00,0x00,0x23,0x24,0x24,0x39,0x00},/*"s",83*/
 193          
 194          {0x00,0x80,0xE0,0x80,0x00,0x00,0x00,0x00,0x1F,0x20,0x20,0x00},/*"t",84*/
 195          
 196          {0x80,0x80,0x00,0x80,0x80,0x00,0x00,0x3F,0x20,0x20,0x3F,0x20},/*"u",85*/
 197          
 198          {0x80,0x80,0x00,0x00,0x80,0x80,0x00,0x07,0x38,0x1C,0x03,0x00},/*"v",86*/
 199          
 200          {0x80,0x40,0x80,0x00,0x80,0x00,0x03,0x3C,0x03,0x3E,0x03,0x00},/*"w",87*/
 201          
 202          {0x80,0x80,0x00,0x80,0x80,0x00,0x20,0x33,0x0E,0x3B,0x20,0x00},/*"x",88*/
 203          
 204          {0x80,0x80,0x00,0x00,0x80,0x80,0x80,0x87,0x78,0x0C,0x03,0x00},/*"y",89*/
 205          
 206          {0x00,0x80,0x80,0x80,0x80,0x00,0x00,0x30,0x2C,0x23,0x30,0x00},/*"z",90*/
 207          
 208          {0x00,0x00,0x80,0x7E,0x02,0x00,0x00,0x00,0x00,0x3F,0x40,0x00},/*"{",91*/
 209          
 210          //{0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00},/*"|",92*/
 211          {0x1C,0x22,0x1C,0xC0,0x40,0x40,0x00,0x00,0x00,0x3F,0x02,0x02},/*"未命名文件",DEG AND F*/
 212          
 213          //{0x00,0x02,0x7E,0x80,0x00,0x00,0x00,0x40,0x3F,0x00,0x00,0x00},/*"}",93*/
 214          {0xF8,0xF0,0xE0,0xC0,0x80,0x00,0x0F,0x07,0x03,0x01,0x00,0x00},/*"未命名文件",0 */
 215          
 216          //{0x06,0x01,0x02,0x04,0x04,0x03,0x00,0x00,0x00,0x00,0x00,0x00},/*"~",94*/ 
 217          {0x1C,0x22,0x1C,0x80,0x40,0x40,0x00,0x00,0x00,0x1F,0x20,0x20},/*"未命名文件",DEG AND C */
 218          
 219          {0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00},/*"|",95*/
 220          
 221          
 222          
 223          };
 224          
 225          
 226          
 227          
 228          sbit CS = P1^4;
 229          sbit RESET = P1^6;
 230          sbit A0 = P1^5;
 231          sbit CLK = P1^3;
 232          sbit DATA = P1^2;
 233          
 234          sbit backlight = P1^7;
 235          
 236          
C51 COMPILER V9.06   LCD                                                                   05/24/2013 13:18:44 PAGE 5   

 237          
 238          
 239          
 240          void Lcd_Write_Byte(char num) //from high to low
 241          {
 242   1              char data i;
 243   1              CS = 0;//Lcd_Set(CS_LOW);
 244   1              _nop_();
 245   1              A0 = 1;//Lcd_Set(A0_HIGH);
 246   1              _nop_();        
 247   1              for(i = 0;i < 8;i++)
 248   1              {
 249   2                      if(num & 0x80)  DATA = 1;//     Lcd_Set(DATA_HIGH);
 250   2              else            DATA = 0;       //Lcd_Set(DATA_LOW);
 251   2                      
 252   2                      _nop_();        
 253   2              CLK = 0;//Lcd_Set(CLK_LOW);
 254   2                      _nop_();
 255   2                      CLK = 1;//Lcd_Set(CLK_HIGH);
 256   2                      _nop_();
 257   2      
 258   2              num <<= 1;      
 259   2              }
 260   1              _nop_();
 261   1              
 262   1              CS = 1;//Lcd_Set(CS_HIGH);//
 263   1              DATA = 1;
 264   1              _nop_();
 265   1      }
 266          
 267          
 268          void Lcd_Write_Command(char command) //from high to low
 269          {
 270   1              char data i;
 271   1              CS = 0;//Lcd_Set(CS_LOW);//
 272   1              _nop_();
 273   1              A0 = 0;//Lcd_Set(A0_LOW);//
 274   1              _nop_();        
 275   1              for(i = 0;i < 8;i++)
 276   1              {
 277   2                      if(command & 0x80)      DATA = 1;//Lcd_Set(DATA_HIGH);
 278   2                      else                    DATA = 0;//Lcd_Set(DATA_LOW);//
 279   2                              
 280   2                      _nop_();
 281   2              CLK = 0;//Lcd_Set(CLK_LOW);//
 282   2                      _nop_();
 283   2      
 284   2                      CLK = 1;//Lcd_Set(CLK_HIGH);//
 285   2                      _nop_();
 286   2      
 287   2              command <<= 1;
 288   2              }
 289   1              _nop_();
 290   1              CS = 1;//Lcd_Set(CS_HIGH);//    
 291   1              DATA = 1;
 292   1              _nop_();
 293   1      }
 294          
 295          
 296          void Lcd_Write_Char(char row,char line,char num,char mode) // row: 0 - 4 , line: 0 - 21
 297          {
 298   1              char data loop; 
C51 COMPILER V9.06   LCD                                                                   05/24/2013 13:18:44 PAGE 6   

 299   1              char data index = num - ' ';
 300   1                      
 301   1              Lcd_Set_X_Addr((line + 1) * 6);
 302   1              Lcd_Set_Y_Addr(row * 2);
 303   1              for(loop = 0;loop < 6;loop++) 
 304   1                      if(mode == 1)   Lcd_Write_Byte(nAsciiDot[index][0][loop]);
 305   1                      else  Lcd_Write_Byte(~nAsciiDot[index][0][loop]);
 306   1              Lcd_Set_X_Addr((line + 1) * 6);
 307   1              Lcd_Set_Y_Addr(row * 2+1);
 308   1              for(loop = 0;loop < 6;loop++) 
 309   1                      if(mode == 1)   Lcd_Write_Byte(nAsciiDot[index][1][loop]);
 310   1                      else Lcd_Write_Byte(~nAsciiDot[index][1][loop]);
 311   1      
 312   1      }
 313          
 314          
 315          void Lcd_Set_Fuction(char mode)
 316          {
 317   1              char data fuction;
 318   1              fuction = 0x38 + mode;//0x20 + mode;
 319   1              Lcd_Write_Command(fuction);
 320   1      }
 321          
 322          void Lcd_Set_Y_Addr(char page)// 0 1 0 0        page 0 - 9
 323          {
 324   1              char data addr;
 325   1              Lcd_Set_Fuction(0);
 326   1              addr = 0x40 + page;
 327   1              Lcd_Write_Command(addr);
 328   1      }
 329          
 330          void Lcd_Set_X_Addr(char line)// 1 1 1 0/1        page 0 - 129
 331          {
 332   1              char data addr;
 333   1              char data line_low;
 334   1              char data line_high;
 335   1              Lcd_Set_Fuction(0);
 336   1              line_low = line & 0x0f;
 337   1              line = line >> 4;
 338   1              line_high = line; 
 339   1              addr = 0xe0 + line_low; //low
 340   1              Lcd_Write_Command(addr);
 341   1              addr = 0xf0 + line_high; //high
 342   1              Lcd_Write_Command(addr);
 343   1      }
 344          
 345          
 346          void lcdreset(void)        /* reset lcd before grogramming */
 347          {
 348   1              RESET = 0;
 349   1      }
 350          
 351          void Display_reboot(void)
 352          {
 353   1      
 354   1              Lcd_Show_String(2,5,"Reboot...",1,9);
 355   1      }
 356          
 357          
 358          
 359          
 360          void Lcd_Initial(void)
C51 COMPILER V9.06   LCD                                                                   05/24/2013 13:18:44 PAGE 7   

 361          {
 362   1              RESET = 0;
 363   1              delay_us(100);
 364   1              RESET = 1;
 365   1              delay_us(10);
 366   1      
 367   1              
 368   1              Lcd_Set_Fuction(1); // 0x21     
 369   1              delay_us(10);
 370   1              Lcd_Write_Command(CMD_SET_BIAS);delay_us(10);   
 371   1              Lcd_Write_Command(CMD_SET_V0);  delay_us(10);
 372   1              Lcd_Write_Command(CMD_DISPLAY_CONFIG);delay_us(10);
 373   1              
 374   1              Lcd_Set_Fuction(0); // 0x20
 375   1              delay_us(10);
 376   1              Lcd_Write_Command(CMD_SET_V0Range_HIGH);    
 377   1              Lcd_Write_Command(CMD_DISPLAT_NORMAL);
 378   1      //      Lcd_Write_Command(CMD_DISPLAY_INVERSE);
 379   1              Lcd_Set_X_Addr(0);  //0xf0 0xe0
 380   1              Lcd_Set_Y_Addr(0);  //0x40
 381   1              
 382   1      
 383   1              delay_us(10);
 384   1              Lcd_All_Off();
 385   1      
 386   1              backlight = 0;
 387   1              
 388   1      }
 389          
 390          
 391          
 392          void Lcd_Show_String(char pos_x,char pos_y,char* str,unsigned char mode,unsigned char length) // pos_x: 0 
             -- 4 , pos_y: 0 - 15
 393          {
 394   1              char data loop = 0;
 395   1              char data by_x,by_y;
 396   1              unsigned char temp = 0;
 397   1              char tempstr[21];
 398   1      
 399   1              for(loop = 0;loop < 21;loop++)   tempstr[21] = ' ';
 400   1      
 401   1              by_x = pos_x;
 402   1              by_y = pos_y;
 403   1                      
 404   1              for(loop = 0;loop < strlen(str);loop++)
 405   1              {
 406   2                      if(mode & 0x80) tempstr[loop] = (char)toupper(str[loop]);
 407   2                      else tempstr[loop] = str[loop];
 408   2              }
 409   1              tempstr[loop] = '\0';
 410   1      
 411   1              if(length & 0x80) 
 412   1              {
 413   2                      for(loop = 0;loop < length - 0x80;loop++)
 414   2                      {
 415   3                              if(temp == 0)
 416   3                              {
 417   4                                      if(*(tempstr + loop) != '\0')   Lcd_Write_Char(by_x,by_y,*(tempstr + loop),mode & 0x7f);
 418   4                                      else  {temp = loop; Lcd_Write_Char(by_x,by_y,' ',mode & 0x7f);}
 419   4                              }
 420   3                              else
 421   3                              {
C51 COMPILER V9.06   LCD                                                                   05/24/2013 13:18:44 PAGE 8   

 422   4                                      Lcd_Write_Char(by_x,by_y,' ',mode & 0x7f);
 423   4                              }
 424   3                              by_y++;         
 425   3                      }
 426   2              
 427   2              }
 428   1              else
 429   1              {
 430   2                      loop = 0;
 431   2                      while(*(tempstr + loop) != '\0')
 432   2                      {               
 433   3                              /*Lcd_Write_Char(by_x,by_y,*(str + loop),mode); 
 434   3                              by_y++;
 435   3                              if(by_y >= 21)
 436   3                              {
 437   3                                      by_y = 0;
 438   3                                      by_x ++;
 439   3                                      if(by_x >= 5)   by_x = 0;
 440   3                              }*/
 441   3                              if(by_y < 21) 
 442   3                              {
 443   4                                      Lcd_Write_Char(by_x,by_y,*(tempstr + loop),mode & 0x7f);        
 444   4                                      by_y++;
 445   4                              }
 446   3                              loop ++;                
 447   3                      }
 448   2              }       
 449   1      }
 450          
 451          
 452          
 453          void Lcd_Show_Data(char pos_x,char pos_y,unsigned int number,char dot,char mode) //,char div, bool signed)
 454          {
 455   1              char data loop = 0;
 456   1              char data num[5];
 457   1              char data length;
 458   1              char data by_x,by_y;
 459   1      
 460   1              by_x = pos_x;
 461   1              by_y = pos_y;   
 462   1      
 463   1              //number = number / div;
 464   1      
 465   1              if(number >= 1000)      length = 4;
 466   1              else if(number >= 100)  length = 3;
 467   1              else if(number >= 10)   length = 2;
 468   1              else length = 1;
 469   1      
 470   1              if((length > 1) && (dot != 0)) 
 471   1              {
 472   2                      length ++;      
 473   2                      num[dot] = '.';
 474   2                      num[4] = number / 1000;         number = number % 1000;
 475   2                      switch(dot)
 476   2                      {
 477   3                              case 3:
 478   3                                              num[2] = number / 100;          number = number % 100;
 479   3                                              num[1] = number / 10;           number = number % 10;
 480   3                                              num[0] = number;
 481   3                                              break;
 482   3                              case 2:
 483   3                                              num[3] = number / 100;          number = number % 100;
C51 COMPILER V9.06   LCD                                                                   05/24/2013 13:18:44 PAGE 9   

 484   3                                              num[1] = number / 10;           number = number % 10;
 485   3                                              num[0] = number;
 486   3                                              break;
 487   3                              case 1:
 488   3                                              num[3] = number / 100;          number = number % 100;
 489   3                                              num[2] = number / 10;           number = number % 10;
 490   3                                              num[0] = number;
 491   3                                              break;
 492   3                      }
 493   2      
 494   2              }
 495   1      
 496   1              else
 497   1              {
 498   2                      num[3] = number / 1000;         number = number % 1000;
 499   2                      num[2] = number / 100;          number = number % 100;
 500   2                      num[1] = number / 10;           number = number % 10;
 501   2                      num[0] = number;
 502   2      
 503   2              }       
 504   1      
 505   1      
 506   1              for(loop = length - 1;loop >= 0;loop--)
 507   1              {
 508   2                      if(num[loop] == '.')    Lcd_Write_Char(by_x,by_y,'.',mode);
 509   2                      else
 510   2                      Lcd_Write_Char(by_x,by_y,aby_Char_Table[num[loop]],mode);
 511   2                      by_y ++;
 512   2                      if(by_y >= 21)
 513   2                      {
 514   3                              by_y = 0;
 515   3                              by_x ++;
 516   3                              if(by_x >= 5)   by_x = 0;
 517   3                      }
 518   2              }
 519   1              for(loop = length;loop < length + 4;loop++)
 520   1              {
 521   2                      Lcd_Write_Char(by_x,by_y,' ',mode);
 522   2                      by_y ++;
 523   2              }
 524   1      }
 525          
 526          
 527          void Lcd_All_Off(void)
 528          {
 529   1              unsigned int data i;
 530   1              
 531   1              for(i = 0;i < 130*80;i++)       
 532   1              {
 533   2                      Lcd_Write_Byte(0x00);
 534   2              }
 535   1      }
 536          
 537          
 538          
 539          
 540          void Lcd_show_for_32bit(char pos_x,char pos_y,unsigned long number,char mode) //,char div, bool signed)
 541          {
 542   1              char data loop = 0;
 543   1              char data num[11];
 544   1              char data length;
 545   1              char data by_x,by_y;
C51 COMPILER V9.06   LCD                                                                   05/24/2013 13:18:44 PAGE 10  

 546   1      
 547   1              by_x = pos_x;
 548   1              by_y = pos_y;   
 549   1      
 550   1              //number = number / div;
 551   1      
 552   1              if         (number >= 1000000000)       length = 10;
 553   1              else if(number >= 100000000)    length = 9;
 554   1              else if(number >= 10000000)             length = 8;
 555   1              else if(number >= 1000000)              length = 7;
 556   1              else if(number >= 100000)               length = 6;
 557   1              else if(number >= 10000)                length = 5;
 558   1              else if(number >= 1000)                 length = 4;
 559   1              else if(number >= 100)                  length = 3;
 560   1              else if(number >= 10)                   length = 2;
 561   1              else                                                    length = 1;
 562   1      
 563   1      //      num[10] = number/ 10000000000;          number = number % 10000000000;
 564   1              num[9] = number / 1000000000;           number = number % 1000000000;
 565   1              num[8] = number / 100000000;            number = number % 100000000;
 566   1              num[7] = number / 10000000;             number = number % 10000000;
 567   1              num[6] = number / 1000000;                      number = number % 1000000;
 568   1              num[5] = number / 100000;                       number = number % 100000;                                       
 569   1              num[4] = number / 10000;                        number = number % 10000;
 570   1              num[3] = number / 1000;                         number = number % 1000;
 571   1              num[2] = number / 100;                          number = number % 100;
 572   1              num[1] = number / 10;                           number = number % 10;
 573   1              num[0] = number;
 574   1      
 575   1      
 576   1      
 577   1              for(loop = length - 1;loop >= 0;loop--)
 578   1              {
 579   2                      if(num[loop] == '.')    Lcd_Write_Char(by_x,by_y,'.',mode);
 580   2                      else
 581   2                      Lcd_Write_Char(by_x,by_y,aby_Char_Table[num[loop]],mode);
 582   2                      by_y ++;
 583   2                      if(by_y >= 21)
 584   2                      {
 585   3                              by_y = 0;
 586   3                              by_x ++;
 587   3                              if(by_x >= 5)   by_x = 0;
 588   3                      }
 589   2              }
 590   1              for(loop = length;loop < length + 4;loop++)
 591   1              {
 592   2                      Lcd_Write_Char(by_x,by_y,' ',mode);
 593   2                      by_y ++;
 594   2              }
 595   1      }
 596          
 597          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2651    ----
   CONSTANT SIZE    =   1172    ----
   XDATA SIZE       =   ----      46
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      38
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V9.06   LCD                                                                   05/24/2013 13:18:44 PAGE 11  

   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
